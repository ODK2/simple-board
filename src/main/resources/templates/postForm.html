<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>게시글 작성</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<h2>게시글 작성</h2>

<form id="postForm">
  <label>제목: <input type="text" id="title"></label>
  <label>작성자: <input type="text" id="writer"></label>
  <br><br>
  <label>내용: <textarea id="content" rows="5" cols="30"></textarea></label><br><br>
  <button type="submit">등록</button>
  <td>
    <a th:href="@{/posts}">목록으로 이동</a>
  </td>
</form>

<script>
  document.getElementById("postForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const postData = {
          title: document.getElementById("title").value,
          content: document.getElementById("content").value,
          writer: document.getElementById("writer").value
      };

      fetch("/api/posts", {
          method: "POST",
          headers: {
              "Content-Type": "application/json"
          },
          body: JSON.stringify(postData)
      }).then(res => {
        if (!res.ok) {
            throw new Error("등록 실패! 관리자에게 문의하세요.");
        }
        return res.json(); // 응답이 JSON일 경우
      }).then(data => {
          alert("등록 완료!");
          location.href = "/posts/" + data.id; // 등록된 글 상세보기로 이동
      }).catch(err => {
          alert("등록 실패! 관리자에게 문의하세요.");
          console.error(err);
      });
  });
</script>

</body>
</html>